<!DOCTYPE html>
<html lang="en-us">

<head>
    <base href="https://martinmmcyt.github.io/hill-climb-race/">
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Hill Climb Race</title>
    <link rel="shortcut icon" href="favicon.png">
    <link rel="stylesheet" href="TemplateData/style.css">

    <style>
        @font-face {
            font-family: BRLNSDB;
            src: url('BRLNSDB.TTF');
        }

        .font1 {
            font-family: BRLNSDB;
            position: absolute;
            left: -10000px;
            visibility: hidden;
        }
    </style>
</head>

<body class="dark">
    <div class="font1">.</div>

    <!-- Smart reload/navigation blocker -->
    <script>
        (function() {
            const blockedDomain = "hillclimb-racing.com";

            function isBlocked(url) {
                try {
                    const u = new URL(url, window.location.href);
                    return u.hostname.includes(blockedDomain);
                } catch {
                    return false;
                }
            }

            // Override location.assign
            const originalAssign = window.location.assign;
            window.location.assign = function(url) {
                if (isBlocked(url)) {
                    console.log("Blocked navigation to:", url);
                    return;
                }
                originalAssign.call(window.location, url);
            };

            // Override location.replace
            const originalReplace = window.location.replace;
            window.location.replace = function(url) {
                if (isBlocked(url)) {
                    console.log("Blocked navigation to:", url);
                    return;
                }
                originalReplace.call(window.location, url);
            };

            // Override direct href changes
            Object.defineProperty(window.location, "href", {
                set: function(url) {
                    if (isBlocked(url)) {
                        console.log("Blocked navigation to:", url);
                        return;
                    }
                    window.location.assign(url);
                },
                get: function() {
                    return window.location.toString();
                }
            });

            // Smart reload override
            const originalReload = window.location.reload;
            window.location.reload = function() {
                if (isBlocked(window.location.href)) {
                    console.log("Blocked reload to blocked domain");
                    return;
                }
                originalReload.call(window.location);
            };

            // Optional: block beforeunload auto reloads
            window.addEventListener("beforeunload", function(event) {
                if (isBlocked(window.location.href)) {
                    console.log("Blocked beforeunload reload/navigation");
                    event.preventDefault();
                    event.returnValue = "";
                    return "";
                }
            });
        })();
    </script>

    <div id="unity-container" class="unity-desktop">
        <canvas id="unity-canvas"></canvas>
    </div>

    <div id="loading-cover" style="display:none;">
        <div id="unity-loading-bar">
            <canvas id="logo-canvas" style="position:absolute;background:black;">
                <img src="loading.png" id="ld_bg">
                <img src="loading_fill.png" id="ld_fill">
            </canvas>
        </div>
    </div>

    <script>
        const container = document.querySelector("#unity-container");
        const canvas = document.querySelector("#unity-canvas");
        const loadingCover = document.querySelector("#loading-cover");

        /* Build Files */
        const buildUrl = "Build";
        const loaderUrl = buildUrl + "/240514.loader.js";

        const config = {
            dataUrl: buildUrl + "/01645275b25b274f0cb8909038c5f06f.data.unityweb",
            frameworkUrl: buildUrl + "/1163de6da1c577d00e7178c7abe540a9.js.unityweb",
            codeUrl: buildUrl + "/1c043b216c20e94f4b98f868c711067b.wasm.unityweb",
            streamingAssetsUrl: "StreamingAssets",
            companyName: "Marty Games",
            productName: "Hill Climb Race",
            productVersion: "1.0"
        };

        if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
            container.className = "unity-mobile";
            config.devicePixelRatio = 1;
        }

        loadingCover.style.display = "";

        const script = document.createElement("script");
        script.src = loaderUrl;
        script.onload = () => {
            createUnityInstance(canvas, config, (progress) => {
                logo_loading_percent = progress;
                drawCanvas(progress);
            }).then((unityInstance) => {
                window.unityInstance = unityInstance;
                setTimeout(() => {
                    loadingCover.style.display = "none";
                    logo_loaded = true;
                }, 1500);
            }).catch((message) => {
                alert(message);
            });
        };

        document.body.appendChild(script);

        /* Loading Logic */
        let logo_loaded = false;
        let logo_loading_percent = 0;
        const logo_canvas = document.getElementById("logo-canvas");

        function drawCanvas(p = 0) {
            if (logo_loaded) return;
            resizeLogoCanvas();
            const ctx = logo_canvas.getContext("2d");
            const bg = document.getElementById("ld_bg");
            const fill = document.getElementById("ld_fill");

            const sw = logo_canvas.width / 1920;
            const sh = logo_canvas.height / 1080;
            p = Math.min(p, 1);

            let pl = 1420 * p + 250;
            let pw = 1420 - (1420 * p);

            ctx.drawImage(bg, 0, 0, logo_canvas.width, logo_canvas.height);
            ctx.drawImage(fill, pl * sw, logo_canvas.height - (125 * sh), pw * sw, 54 * sh);

            ctx.font = (56 * sw) + "px BRLNSDB";
            ctx.fillStyle = "#fff";
            ctx.strokeStyle = "#000";
            ctx.lineWidth = 6;

            const txt = Math.floor(p * 100) + "%";
            const tx = logo_canvas.width * 0.5 - ctx.measureText(txt).width * 0.5;
            const ty = logo_canvas.height * 0.5 + 460 * sh;

            ctx.strokeText(txt, tx, ty);
            ctx.fillText(txt, tx, ty);
        }

        function resizeLogoCanvas() {
            const w = window.innerWidth;
            const h = window.innerHeight;
            const nw = h * 16 / 9;
            if (nw <= w) {
                logo_canvas.width = nw;
                logo_canvas.height = h;
            } else {
                logo_canvas.width = w;
                logo_canvas.height = w * 9 / 16;
            }
        }

        window.onresize = () => drawCanvas(logo_loading_percent);
        window.onload = () => drawCanvas(logo_loading_percent);
    </script>
</body>

</html>
